version: 2

project_name: polyforge

env_files:
    github_token: ~/.config/goreleaser/github_token

before:
    hooks:
        - go tool goimports -format-only -v -w .

        - go vet
        - go mod tidy
        - go mod vendor

builds:
    -   env:
            - CGO_ENABLED=0
        ldflags:
            - "-s -w -X main.version={{.Version}} -X main.commit={{.Commit}} -X main.date={{.Date}} -X main.sources=no-include"
        goos:
            - linux
            - darwin

archives:
    -   formats: [ "tar.gz" ]
        name_template: >-
            {{ .ProjectName }}-
            {{- .Os }}-
            {{- if eq .Arch "amd64" }}x86-64
            {{- else if eq .Arch "386" }}i386
            {{- else }}{{ .Arch }}{{ end }}
            {{- if .Arm }}v{{ .Arm }}{{ end }}
        format_overrides:
            -   goos: windows
                formats: [ "zip" ]

homebrew_casks:
    -   name: polyforge

        binary: polyforge

        url:
            verified: github.com/polyium/polyforge
            using: ":homebrew_curl"
            cookies:
                license: "accept-backup"

            headers:
                - "X-Version: {{ .Version }}"

        hooks:
            post:
                install: |
                    if OS.mac?
                      system_command "/usr/bin/xattr", args: ["-dr", "com.apple.quarantine", "#{staged_path}/polyforge"]
                    end

        commit_author:
            name: Jacob B. Sanders
            email: 60639231+Segmentational@users.noreply.github.com

        commit_msg_template: "bump(version): {{ .Tag }}"

        homepage: "https://github.com/polyium/polyforge"

        description: "CLI"

        license: "MIT"

        skip_upload: false

        repository:
            branch: main
            owner: polyium
            name: homebrew-taps

changelog:
    use: github-native
